(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const _ of o)if(_.type==="childList")for(const u of _.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const _={};return o.integrity&&(_.integrity=o.integrity),o.referrerPolicy&&(_.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?_.credentials="include":o.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function r(o){if(o.ep)return;o.ep=!0;const _=n(o);fetch(o.href,_)}})();var V,f,De,T,re,ve,J,R={},ge=[],$e=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ee=Array.isArray;function S(e,t){for(var n in t)e[n]=t[n];return e}function we(e){var t=e.parentNode;t&&t.removeChild(e)}function Ne(e,t,n){var r,o,_,u={};for(_ in t)_=="key"?r=t[_]:_=="ref"?o=t[_]:u[_]=t[_];if(arguments.length>2&&(u.children=arguments.length>3?V.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(_ in e.defaultProps)u[_]===void 0&&(u[_]=e.defaultProps[_]);return q(e,u,r,o,null)}function q(e,t,n,r,o){var _={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:o??++De,__i:-1,__u:0};return o==null&&f.vnode!=null&&f.vnode(_),_}function N(e){return e.children}function I(e,t){this.props=e,this.context=t}function E(e,t){if(t==null)return e.__?E(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?E(e):null}function be(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return be(e)}}function _e(e){(!e.__d&&(e.__d=!0)&&T.push(e)&&!W.__r++||re!==f.debounceRendering)&&((re=f.debounceRendering)||ve)(W)}function W(){var e,t,n,r,o,_,u,c,p;for(T.sort(J);e=T.shift();)e.__d&&(t=T.length,r=void 0,_=(o=(n=e).__v).__e,c=[],p=[],(u=n.__P)&&((r=S({},o)).__v=o.__v+1,f.vnode&&f.vnode(r),te(u,r,o,n.__n,u.ownerSVGElement!==void 0,32&o.__u?[_]:null,c,_??E(o),!!(32&o.__u),p),r.__.__k[r.__i]=r,Ce(c,r,p),r.__e!=_&&be(r)),T.length>t&&T.sort(J));W.__r=0}function ke(e,t,n,r,o,_,u,c,p,s,y){var a,h,l,D,w,m=r&&r.__k||ge,g=t.length;for(n.__d=p,Se(n,t,m),p=n.__d,a=0;a<g;a++)(l=n.__k[a])!=null&&typeof l!="boolean"&&typeof l!="function"&&(h=l.__i===-1?R:m[l.__i]||R,l.__i=a,te(e,l,h,o,_,u,c,p,s,y),D=l.__e,l.ref&&h.ref!=l.ref&&(h.ref&&ne(h.ref,null,l),y.push(l.ref,l.__c||D,l)),w==null&&D!=null&&(w=D),65536&l.__u||h.__k===l.__k?p=Fe(l,p,e):typeof l.type=="function"&&l.__d!==void 0?p=l.__d:D&&(p=D.nextSibling),l.__d=void 0,l.__u&=-196609);n.__d=p,n.__e=w}function Se(e,t,n){var r,o,_,u,c,p=t.length,s=n.length,y=s,a=0;for(e.__k=[],r=0;r<p;r++)(o=e.__k[r]=(o=t[r])==null||typeof o=="boolean"||typeof o=="function"?null:typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?q(null,o,null,null,o):ee(o)?q(N,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?q(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o)!=null?(o.__=e,o.__b=e.__b+1,c=Ye(o,n,u=r+a,y),o.__i=c,_=null,c!==-1&&(y--,(_=n[c])&&(_.__u|=131072)),_==null||_.__v===null?(c==-1&&a--,typeof o.type!="function"&&(o.__u|=65536)):c!==u&&(c===u+1?a++:c>u?y>p-u?a+=c-u:a--:a=c<u&&c==u-1?c-u:0,c!==r+a&&(o.__u|=65536))):(_=n[r])&&_.key==null&&_.__e&&(_.__e==e.__d&&(e.__d=E(_)),K(_,_,!1),n[r]=null,y--);if(y)for(r=0;r<s;r++)(_=n[r])!=null&&!(131072&_.__u)&&(_.__e==e.__d&&(e.__d=E(_)),K(_,_))}function Fe(e,t,n){var r,o;if(typeof e.type=="function"){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=Fe(r[o],t,n));return t}return e.__e!=t&&(n.insertBefore(e.__e,t||null),t=e.__e),t&&t.nextSibling}function Ye(e,t,n,r){var o=e.key,_=e.type,u=n-1,c=n+1,p=t[n];if(p===null||p&&o==p.key&&_===p.type)return n;if(r>(p!=null&&!(131072&p.__u)?1:0))for(;u>=0||c<t.length;){if(u>=0){if((p=t[u])&&!(131072&p.__u)&&o==p.key&&_===p.type)return u;u--}if(c<t.length){if((p=t[c])&&!(131072&p.__u)&&o==p.key&&_===p.type)return c;c++}}return-1}function oe(e,t,n){t[0]==="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||$e.test(t)?n:n+"px"}function M(e,t,n,r,o){var _;e:if(t==="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||oe(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||oe(e.style,t,n[t])}else if(t[0]==="o"&&t[1]==="n")_=t!==(t=t.replace(/(PointerCapture)$|Capture$/,"$1")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+_]=n,n?r?n.u=r.u:(n.u=Date.now(),e.addEventListener(t,_?ie:ae,_)):e.removeEventListener(t,_?ie:ae,_);else{if(o)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="width"&&t!=="height"&&t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t!=="rowSpan"&&t!=="colSpan"&&t!=="role"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!=="-"?e.removeAttribute(t):e.setAttribute(t,n))}}function ae(e){var t=this.l[e.type+!1];if(e.t){if(e.t<=t.u)return}else e.t=Date.now();return t(f.event?f.event(e):e)}function ie(e){return this.l[e.type+!0](f.event?f.event(e):e)}function te(e,t,n,r,o,_,u,c,p,s){var y,a,h,l,D,w,m,g,v,d,P,$,Y,b,B,C=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(p=!!(32&n.__u),_=[c=t.__e=n.__e]),(y=f.__b)&&y(t);e:if(typeof C=="function")try{if(g=t.props,v=(y=C.contextType)&&r[y.__c],d=y?v?v.props.value:y.__:r,n.__c?m=(a=t.__c=n.__c).__=a.__E:("prototype"in C&&C.prototype.render?t.__c=a=new C(g,d):(t.__c=a=new I(g,d),a.constructor=C,a.render=Ee),v&&v.sub(a),a.props=g,a.state||(a.state={}),a.context=d,a.__n=r,h=a.__d=!0,a.__h=[],a._sb=[]),a.__s==null&&(a.__s=a.state),C.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=S({},a.__s)),S(a.__s,C.getDerivedStateFromProps(g,a.__s))),l=a.props,D=a.state,a.__v=t,h)C.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(C.getDerivedStateFromProps==null&&g!==l&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(g,d),!a.__e&&(a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(g,a.__s,d)===!1||t.__v===n.__v)){for(t.__v!==n.__v&&(a.props=g,a.state=a.__s,a.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(U){U&&(U.__=t)}),P=0;P<a._sb.length;P++)a.__h.push(a._sb[P]);a._sb=[],a.__h.length&&u.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(g,a.__s,d),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(l,D,w)})}if(a.context=d,a.props=g,a.__P=e,a.__e=!1,$=f.__r,Y=0,"prototype"in C&&C.prototype.render){for(a.state=a.__s,a.__d=!1,$&&$(t),y=a.render(a.props,a.state,a.context),b=0;b<a._sb.length;b++)a.__h.push(a._sb[b]);a._sb=[]}else do a.__d=!1,$&&$(t),y=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++Y<25);a.state=a.__s,a.getChildContext!=null&&(r=S(S({},r),a.getChildContext())),h||a.getSnapshotBeforeUpdate==null||(w=a.getSnapshotBeforeUpdate(l,D)),ke(e,ee(B=y!=null&&y.type===N&&y.key==null?y.props.children:y)?B:[B],t,n,r,o,_,u,c,p,s),a.base=t.__e,t.__u&=-161,a.__h.length&&u.push(a),m&&(a.__E=a.__=null)}catch(U){t.__v=null,p||_!=null?(t.__e=c,t.__u|=p?160:32,_[_.indexOf(c)]=null):(t.__e=n.__e,t.__k=n.__k),f.__e(U,t,n)}else _==null&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=Te(n.__e,t,n,r,o,_,u,p,s);(y=f.diffed)&&y(t)}function Ce(e,t,n){t.__d=void 0;for(var r=0;r<n.length;r++)ne(n[r],n[++r],n[++r]);f.__c&&f.__c(t,e),e.some(function(o){try{e=o.__h,o.__h=[],e.some(function(_){_.call(o)})}catch(_){f.__e(_,o.__v)}})}function Te(e,t,n,r,o,_,u,c,p){var s,y,a,h,l,D,w,m=n.props,g=t.props,v=t.type;if(v==="svg"&&(o=!0),_!=null){for(s=0;s<_.length;s++)if((l=_[s])&&"setAttribute"in l==!!v&&(v?l.localName===v:l.nodeType===3)){e=l,_[s]=null;break}}if(e==null){if(v===null)return document.createTextNode(g);e=o?document.createElementNS("http://www.w3.org/2000/svg",v):document.createElement(v,g.is&&g),_=null,c=!1}if(v===null)m===g||c&&e.data===g||(e.data=g);else{if(_=_&&V.call(e.childNodes),m=n.props||R,!c&&_!=null)for(m={},s=0;s<e.attributes.length;s++)m[(l=e.attributes[s]).name]=l.value;for(s in m)l=m[s],s=="children"||(s=="dangerouslySetInnerHTML"?a=l:s==="key"||s in g||M(e,s,null,l,o));for(s in g)l=g[s],s=="children"?h=l:s=="dangerouslySetInnerHTML"?y=l:s=="value"?D=l:s=="checked"?w=l:s==="key"||c&&typeof l!="function"||m[s]===l||M(e,s,l,m[s],o);if(y)c||a&&(y.__html===a.__html||y.__html===e.innerHTML)||(e.innerHTML=y.__html),t.__k=[];else if(a&&(e.innerHTML=""),ke(e,ee(h)?h:[h],t,n,r,o&&v!=="foreignObject",_,u,_?_[0]:n.__k&&E(n,0),c,p),_!=null)for(s=_.length;s--;)_[s]!=null&&we(_[s]);c||(s="value",D!==void 0&&(D!==e[s]||v==="progress"&&!D||v==="option"&&D!==m[s])&&M(e,s,D,m[s],!1),s="checked",w!==void 0&&w!==e[s]&&M(e,s,w,m[s],!1))}return e}function ne(e,t,n){try{typeof e=="function"?e(t):e.current=t}catch(r){f.__e(r,n)}}function K(e,t,n){var r,o;if(f.unmount&&f.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||ne(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(_){f.__e(_,t)}r.base=r.__P=null,e.__c=void 0}if(r=e.__k)for(o=0;o<r.length;o++)r[o]&&K(r[o],t,n||typeof e.type!="function");n||e.__e==null||we(e.__e),e.__=e.__e=e.__d=void 0}function Ee(e,t,n){return this.constructor(e,n)}function He(e,t,n){var r,o,_,u;f.__&&f.__(e,t),o=(r=typeof n=="function")?null:n&&n.__k||t.__k,_=[],u=[],te(t,e=(!r&&n||t).__k=Ne(N,null,[e]),o||R,R,t.ownerSVGElement!==void 0,!r&&n?[n]:o?null:t.firstChild?V.call(t.childNodes):null,_,!r&&n?n:o?o.__e:t.firstChild,r,u),Ce(_,e,u)}V=ge.slice,f={__e:function(e,t,n,r){for(var o,_,u;t=t.__;)if((o=t.__c)&&!o.__)try{if((_=o.constructor)&&_.getDerivedStateFromError!=null&&(o.setState(_.getDerivedStateFromError(e)),u=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(e,r||{}),u=o.__d),u)return o.__E=o}catch(c){e=c}throw e}},De=0,I.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=S({},this.state),typeof e=="function"&&(e=e(S({},n),this.props)),e&&S(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),_e(this))},I.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),_e(this))},I.prototype.render=N,T=[],ve=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,J=function(e,t){return e.__v.__b-t.__v.__b},W.__r=0;var Q,F,j,le,X=0,xe=[],O=[],ce=f.__b,ue=f.__r,se=f.diffed,pe=f.__c,de=f.unmount;function Le(e,t){f.__h&&f.__h(F,e,X||t),X=0;var n=F.__H||(F.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:O}),n.__[e]}function he(e){return X=1,Re(Pe,e)}function Re(e,t,n){var r=Le(Q++,2);if(r.t=e,!r.__c&&(r.__=[n?n(t):Pe(void 0,t),function(c){var p=r.__N?r.__N[0]:r.__[0],s=r.t(p,c);p!==s&&(r.__N=[s,r.__[1]],r.__c.setState({}))}],r.__c=F,!F.u)){var o=function(c,p,s){if(!r.__c.__H)return!0;var y=r.__c.__H.__.filter(function(h){return h.__c});if(y.every(function(h){return!h.__N}))return!_||_.call(this,c,p,s);var a=!1;return y.forEach(function(h){if(h.__N){var l=h.__[0];h.__=h.__N,h.__N=void 0,l!==h.__[0]&&(a=!0)}}),!(!a&&r.__c.props===c)&&(!_||_.call(this,c,p,s))};F.u=!0;var _=F.shouldComponentUpdate,u=F.componentWillUpdate;F.componentWillUpdate=function(c,p,s){if(this.__e){var y=_;_=void 0,o(c,p,s),_=y}u&&u.call(this,c,p,s)},F.shouldComponentUpdate=o}return r.__N||r.__}function Ue(){for(var e;e=xe.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(A),e.__H.__h.forEach(Z),e.__H.__h=[]}catch(t){e.__H.__h=[],f.__e(t,e.__v)}}f.__b=function(e){F=null,ce&&ce(e)},f.__r=function(e){ue&&ue(e),Q=0;var t=(F=e.__c).__H;t&&(j===F?(t.__h=[],F.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=O,n.__N=n.i=void 0})):(t.__h.forEach(A),t.__h.forEach(Z),t.__h=[],Q=0)),j=F},f.diffed=function(e){se&&se(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(xe.push(t)!==1&&le===f.requestAnimationFrame||((le=f.requestAnimationFrame)||Me)(Ue)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==O&&(n.__=n.__V),n.i=void 0,n.__V=O})),j=F=null},f.__c=function(e,t){t.some(function(n){try{n.__h.forEach(A),n.__h=n.__h.filter(function(r){return!r.__||Z(r)})}catch(r){t.some(function(o){o.__h&&(o.__h=[])}),t=[],f.__e(r,n.__v)}}),pe&&pe(e,t)},f.unmount=function(e){de&&de(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{A(r)}catch(o){t=o}}),n.__H=void 0,t&&f.__e(t,n.__v))};var fe=typeof requestAnimationFrame=="function";function Me(e){var t,n=function(){clearTimeout(r),fe&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);fe&&(t=requestAnimationFrame(n))}function A(e){var t=F,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),F=t}function Z(e){var t=F;e.__c=e.__(),F=t}function Pe(e,t){return typeof t=="function"?t(e):t}var qe=0;function i(e,t,n,r,o,_){var u,c,p={};for(c in t)c=="ref"?u=t[c]:p[c]=t[c];var s={type:e,props:p,key:n,ref:u,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--qe,__i:-1,__u:0,__source:o,__self:_};if(typeof e=="function"&&(u=e.defaultProps))for(c in u)p[c]===void 0&&(p[c]=u[c]);return f.vnode&&f.vnode(s),s}const Ie={sum:123e3,startDate:"2015-08-03",endDate:"2023-12-24",rate:.5,periodicity:"day",rateType:"percent",maxRate:10,payments:[{paymentDate:"2015-09-04",paymentAmount:1e5,paymentNote:"First payment"},{paymentDate:"2015-12-07",paymentAmount:15e4,paymentNote:"Second payment"}],debts:[{debtDate:"2015-10-02",debtAmount:76262,debtNote:"Additional debt"},{debtDate:"2015-12-02",debtAmount:150153,debtNote:"Additional debt"},{debtDate:"2015-11-02",debtAmount:87146,debtNote:"Additional debt"}]},z=(e,t,n)=>`${e.toFixed(2)} x ${t} x ${n}%`,H=(e,t,n)=>`${e.toFixed(2)} x ${t}/365 x ${n}%`,ye=(e,t,n)=>`${e.toFixed(2)} x ${t}/366 x ${n}%`,L=(e,t,n)=>e*t/365*n/100,me=(e,t,n)=>e*t/366*n/100,G=(e,t,n)=>e*t*n/100,k=(e,t)=>{const n=new Date(e),o=new Date(t)-n;return Math.ceil(o/(1e3*60*60*24))+1},x=e=>{const t=new Date(e);return t.setDate(t.getDate()+1)?new Date(t).toISOString().split("T")[0]:null},Oe=e=>{const t={sum:0,overpayment:0,sumPercent:0,penalties:[],periodicity:e.periodicity};return e.debts.unshift({debtDate:e.startDate,debtAmount:e.sum,debtNote:e.note}),e.debts.sort((n,r)=>new Date(n.debtDate)-new Date(r.debtDate)),e.payments.sort((n,r)=>new Date(n.paymentDate)-new Date(r.paymentDate)),e.debts.forEach(({debtAmount:n,debtDate:r,debtNote:o})=>{var u,c,p,s,y,a,h,l,D,w,m,g;const _={sum:0,maxSum:n*e.maxRate/100,data:[],debtDate:r,debtNote:o};for(let v=0;v<e.payments.length;v++){const{paymentDate:d,paymentAmount:P,paymentNote:$}=e.payments[v];if(P!==0&&n!==0){_.data.push({debt:new Date(d)<new Date(r)||_.data.find(({payment:b})=>new Date(b.paymentDate)>new Date(e.endDate))?null:{debtAmount:n,debtDate:x((u=_.data.at(-1))==null?void 0:u.payment.paymentDate)??r,paymentDate:new Date(d)>new Date(e.endDate)?e.endDate:d,days:k(x((c=_.data.at(-1))==null?void 0:c.payment.paymentDate)??r,new Date(d)>new Date(e.endDate)?e.endDate:d),formula:t.periodicity==="year"?H(n,k(x((p=_.data.at(-1))==null?void 0:p.payment.paymentDate)??r,new Date(d)>new Date(e.endDate)?e.endDate:d),e.rate):z(n,k(x((s=_.data.at(-1))==null?void 0:s.payment.paymentDate)??r,new Date(d)>new Date(e.endDate)?e.endDate:d),e.rate),penaltyAmount:t.periodicity==="year"?L(n,k(x((y=_.data.at(-1))==null?void 0:y.payment.paymentDate)??r,new Date(d)>new Date(e.endDate)?e.endDate:d),e.rate):G(n,k(x((a=_.data.at(-1))==null?void 0:a.payment.paymentDate)??r,new Date(d)>new Date(e.endDate)?e.endDate:d),e.rate)},payment:{paymentAmount:Math.min(P,n),paymentDate:d,paymentNote:$}});const Y=n;if(n-=Math.min(P,Y),e.payments[v].paymentAmount-=Math.min(P,Y),n>0&&v===e.payments.length-1&&!_.data.find(({payment:b})=>new Date(b.paymentDate)>new Date(e.endDate))&&(t.sum+=n,_.data.push({debt:{debtAmount:n,debtDate:x((h=_.data.at(-1))==null?void 0:h.payment.paymentDate)??r,paymentDate:t.periodicity==="year"?new Date(new Date(r).getFullYear(),11,31):e.endDate,days:k(x((l=_.data.at(-1))==null?void 0:l.payment.paymentDate)??r,t.periodicity==="year"?new Date(new Date(r).getFullYear(),11,31):e.endDate),formula:t.periodicity==="year"?H(n,k(x((D=_.data.at(-1))==null?void 0:D.payment.paymentDate)??r,t.periodicity==="year"?new Date(new Date(r).getFullYear(),11,31):e.endDate),e.rate):z(n,k(x((w=_.data.at(-1))==null?void 0:w.payment.paymentDate)??r,t.periodicity==="year"?new Date(new Date(r).getFullYear(),11,31):e.endDate),e.rate),penaltyAmount:t.periodicity==="year"?L(n,k(x((m=_.data.at(-1))==null?void 0:m.payment.paymentDate)??r,t.periodicity==="year"?new Date(new Date(r).getFullYear(),11,31):e.endDate),e.rate):G(n,k(x((g=_.data.at(-1))==null?void 0:g.payment.paymentDate)??r,e.endDate),e.rate)}}),t.periodicity==="year"))for(let b=new Date(r).getFullYear()+1;b<=new Date(e.endDate).getFullYear();b++)b%4===0?_.data.push({debt:{debtAmount:n,debtDate:new Date(b,0,1),paymentDate:b===new Date(e.endDate).getFullYear()?e.endDate:new Date(b,11,31),days:b===new Date(e.endDate).getFullYear()?k(new Date(b,0,1),e.endDate):366,formula:ye(n,b===new Date(e.endDate).getFullYear()?k(new Date(b,0,1),e.endDate):366,e.rate),penaltyAmount:me(n,b===new Date(e.endDate).getFullYear()?k(new Date(b,0,1),e.endDate):366,e.rate)}}):_.data.push({debt:{debtAmount:n,debtDate:new Date(b,0,1),paymentDate:b===new Date(e.endDate).getFullYear()?e.endDate:new Date(b,11,31),days:b===new Date(e.endDate).getFullYear()?k(new Date(b,0,1),e.endDate):365,formula:H(n,b===new Date(e.endDate).getFullYear()?k(new Date(b,0,1),e.endDate):365,e.rate),penaltyAmount:L(n,b===new Date(e.endDate).getFullYear()?k(new Date(b,0,1),e.endDate):365,e.rate)}})}}if(_.data.length)t.penalties.push(_);else{t.sum+=n;const v=[{debt:{debtAmount:n,debtDate:r,paymentDate:t.periodicity==="year"?new Date(new Date(r).getFullYear(),11,31):e.endDate,days:k(r,t.periodicity==="year"?new Date(new Date(r).getFullYear(),11,31):e.endDate),formula:t.periodicity==="year"?H(n,k(r,new Date(new Date(r).getFullYear(),11,31)),e.rate):z(n,k(r,e.endDate),e.rate),penaltyAmount:t.periodicity==="year"?L(n,k(r,new Date(new Date(r).getFullYear(),11,31)),e.rate):G(n,k(r,e.endDate),e.rate)}}];if(t.periodicity==="year")for(let d=new Date(r).getFullYear()+1;d<=new Date(e.endDate).getFullYear();d++)d%4===0?v.push({debt:{debtAmount:n,debtDate:new Date(d,0,1),paymentDate:d===new Date(e.endDate).getFullYear()?e.endDate:new Date(d,11,31),days:d===new Date(e.endDate).getFullYear()?k(new Date(d,0,1),e.endDate):366,formula:ye(n,d===new Date(e.endDate).getFullYear()?k(new Date(d,0,1),e.endDate):366,e.rate),penaltyAmount:me(n,d===new Date(e.endDate).getFullYear()?k(new Date(d,0,1),e.endDate):366,e.rate)}}):v.push({debt:{debtAmount:n,debtDate:new Date(d,0,1),paymentDate:d===new Date(e.endDate).getFullYear()?e.endDate:new Date(d,11,31),days:d===new Date(e.endDate).getFullYear()?k(new Date(d,0,1),e.endDate):365,formula:H(n,d===new Date(e.endDate).getFullYear()?k(new Date(d,0,1),e.endDate):365,e.rate),penaltyAmount:L(n,d===new Date(e.endDate).getFullYear()?k(new Date(d,0,1),e.endDate):365,e.rate)}});t.penalties.push({..._,data:v})}t.penalties.forEach((v,d,P)=>{P[d].sum=v.data.reduce(($,{debt:Y})=>($+=Y.penaltyAmount,$),0)}),t.sumPercent=t.penalties.reduce((v,d)=>(v+=Math.min(d.maxSum,d.sum),v),0),t.overpayment=e.payments.reduce((v,d)=>(v+=d.paymentAmount,v),0)}),console.log(t),t},Ae=()=>{const[e,t]=he(null),[n,r]=he({sum:0,startDate:"",endDate:"",rate:0,periodicity:"day",rateType:"percent",maxRate:0,payments:[],debts:[]}),o=h=>{const{name:l,value:D}=h.target;r(w=>({...w,[l]:D}))},_=()=>{const h={paymentDate:"",paymentAmount:"",paymentNote:""};r(l=>({...l,payments:[...l.payments,h]}))},u=h=>{r(l=>{const D=[...l.payments];return D.splice(h,1),{...l,payments:D}})},c=(h,l)=>{const{name:D,value:w}=h.target;r(m=>{const g=[...m.payments];return g[l][D]=w,{...m,payments:g}})},p=()=>{const h={debtDate:"",debtAmount:"",debtNote:""};r(l=>({...l,debts:[...l.debts,h]}))},s=h=>{r(l=>{const D=[...l.debts];return D.splice(h,1),{...l,debts:D}})},y=(h,l)=>{const{name:D,value:w}=h.target;r(m=>{const g=[...m.debts];return g[l]={...g[l],[D]:w},{...m,debts:g}})};return i(N,{children:[i("form",{onSubmit:h=>{h.preventDefault();const l=Oe(JSON.parse(JSON.stringify(n)));t(l)},children:[i("a",{href:"#",onClick:()=>r(Ie),children:"Пример заполненой формы"}),i("fieldset",{children:[i("legend",{children:"Введите параметры задолженности"}),i("input",{type:"number",placeholder:"Сумма задолженности",name:"sum",value:n.sum,onChange:o,required:!0}),i("h4",{children:"Период задолженности"}),i("input",{type:"date",name:"startDate",value:n.startDate,onChange:o,required:!0}),"-",i("input",{type:"date",name:"endDate",value:n.endDate,onChange:o,required:!0}),i("h4",{children:"Ставка"}),i("select",{name:"rateType",value:n==null?void 0:n.rateType,onChange:o,children:[i("option",{value:"",selected:!0,disabled:!0,hidden:!0,children:"Ставка"}),i("option",{value:"percent",children:"%"}),i("option",{value:"fraction",children:"Ставка ЦБ"})]}),(n==null?void 0:n.rateType)==="percent"?i(N,{children:i("input",{step:"0.01",type:"number",placeholder:"Размер",name:"rate",value:n.rate,onChange:o,required:!0})}):i(N,{children:i(InputMask,{mask:"9/9999999999999",type:"text",name:"fraction",placeholder:"Доля"})}),i("select",{name:"periodicity",value:n==null?void 0:n.periodicity,onChange:o,children:[i("option",{value:"",selected:!0,disabled:!0,hidden:!0,children:"Периодичность"}),i("option",{value:"day",children:"В день"}),i("option",{value:"year",children:"В год"})]}),i("input",{type:"number",name:"maxRate",placeholder:"Ограничение %",value:n.maxRate,onChange:o,required:!0}),i("h4",{children:"Частичная оплата задолженности"}),n.payments.map(({paymentDate:h,paymentAmount:l,paymentNote:D},w)=>i("div",{children:[i("input",{type:"date",name:"paymentDate",value:h,onChange:m=>c(m,w),required:!0}),i("input",{type:"number",name:"paymentAmount",value:l,placeholder:"Сумма",onChange:m=>c(m,w),required:!0}),i("input",{type:"text",name:"paymentNote",placeholder:"Примечание",value:D,onChange:m=>c(m,w),required:!0}),i("button",{type:"button",onClick:()=>u(w),children:"Удалить"})]},w)),i("button",{type:"button",onClick:_,children:"Добавить"}),i("h4",{children:"Дополнительные задолженности"}),n.debts.map(({debtAmount:h,debtDate:l,debtNote:D},w)=>i("div",{children:[i("input",{type:"date",name:"debtDate",value:l,onChange:m=>y(m,w),required:!0}),i("input",{type:"number",name:"debtAmount",placeholder:"Сумма",value:h,onChange:m=>y(m,w),required:!0}),i("input",{type:"text",name:"debtNote",placeholder:"Примечание",value:D,onChange:m=>y(m,w),required:!0}),i("button",{type:"button",onClick:()=>s(w),children:"Удалить"})]},w)),i("button",{type:"button",onClick:p,children:"Добавить"}),i("div",{children:i("button",{type:"submit",children:"Рассчитать"})})]})]}),e&&i(We,{result:e})]})},We=({result:e})=>i(N,{children:[" ",e.penalties.map(({sum:t,maxSum:n,data:r,debtDate:o,debtNote:_})=>i("table",{children:[i("caption",{children:["Расчёт процентов по задолженности, возникшей"," ",i("time",{dateTime:o,children:new Date(o).toLocaleDateString("ru-RU")})," ",i("i",{children:[_&&`(${_})`," "]})]}),i("thead",{children:[i("tr",{children:[i("th",{rowspan:2,children:"Задолженность"}),i("th",{colspan:3,children:"Период просрочки"}),e.periodicity==="year"&&i("th",{rowspan:2,children:"Дней в году "}),i("th",{rowspan:2,children:"Формула"}),i("th",{rowspan:2,children:"Неустойка"})]}),i("tr",{children:[i("th",{children:"с"}),i("th",{children:"по"}),i("th",{children:"дней"})]})]}),i("tbody",{children:r.map(({debt:u,payment:c})=>i(N,{children:[u&&i("tr",{children:[i("td",{children:u.debtAmount.toFixed(2)}),i("td",{children:i("time",{dateTime:u.debtDate,children:new Date(u.debtDate).toLocaleDateString("ru-RU")})}),i("td",{children:i("time",{dateTime:u.paymentDate,children:new Date(u.paymentDate).toLocaleDateString("ru-RU")})}),i("td",{children:u.days}),i("td",{children:u.days===366?366:365}),i("td",{children:u.formula}),i("td",{children:u.penaltyAmount.toFixed(2)})]}),c&&i("tr",{style:{backgroundColor:"lightyellow"},children:[i("td",{children:["-",c.paymentAmount.toFixed(2)]}),i("td",{children:i("time",{dateTime:c.paymentDate,children:new Date(c.paymentDate).toLocaleDateString("ru-RU")})}),i("td",{colSpan:5,children:["Оплата задолженности"," ",i("i",{children:c.paymentNote&&`(${c.paymentNote})`})]})]})]}))}),i("tfoot",{children:[i("tr",{children:[i("td",{children:i("b",{children:"Итого:"})}),i("td",{colspan:6,children:t>=n?i("s",{children:[t.toFixed(2)," р."]}):`${t.toFixed(2)} р.`})]}),t>=n&&i("tr",{children:[i("td",{children:i("b",{children:["но не более ",e.maxRate,"%:"]})}),i("td",{colspan:6,children:[n.toFixed(2)," руб."]})]})]})]})),i("table",{children:i("tbody",{children:[i("tr",{children:[i("td",{children:i("b",{children:"Сумма основного долга: "})}),i("td",{colspan:5,children:[e.sum.toFixed(2)," руб."]})]}),!!e.overpayment&&i("tr",{children:[i("td",{children:"Переплата:"}),i("td",{colspan:5,children:[e.overpayment.toFixed(2)," руб."]})]}),i("tr",{children:[i("td",{children:i("b",{children:"Сумма процентов по всем задолженностям: "})}),i("td",{colspan:5,children:[e.sumPercent.toFixed(2)," руб."]})]})]})})]});He(i(Ae,{}),document.getElementById("penalty-calculator"));
